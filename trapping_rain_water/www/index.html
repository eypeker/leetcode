<!DOCTYPE html>
<html>
<head>
    <title>Trapping Rain Water</title>
    <script>
        console.log("This script gets run");
        /*const importObject = {
            Math: {
                random: () => Math.random(),
            }
        };*/
        //or 
        //const importObject = {Math}
        
        async function fetchAndInstantiate() {
            const response = await fetch("./trapping_rain_water.wasm").then( response => {
                response.arrayBuffer().then(buffer => {
                    WebAssembly.instantiate(buffer).then(wasm => {
                        console.log(wasm.instance.exports.trap)
                        const elevation = [2,1,0,2,1,0,1,3,2,1,2,3];
                        const trap = wasm.instance.exports.trap;
                        let ptr = wasm.instance.exports.__wbindgen_malloc(elevation.length * 4);
                        const buffer = new Uint32Array(wasm.instance.exports.memory.buffer);
                        buffer.set(elevation, ptr/4);
                        const res = trap(ptr, elevation.length);
                        console.log(res);
                    })
                })
            })
            //const buffer = await response.arrayBuffer();
            //const wasm = await WebAssembly.instantiate(buffer);
            //console.log(wasm.instance.exports.trap); 
        }
        
        fetchAndInstantiate();
        console.log("This script also finishes");
    </script>
</head>
<body>


</body>

</html>